---
import * as fs from 'fs';
import * as path from 'path';
import SlideShow from '../components/SlideShow.svelte';
import ShowTime from '../components/ShowTime.svelte';
import '../styles/globals.scss';

const IMAGES_DIR = '/images/slideshow';

const publicPath = path.join(process.cwd(), 'public', IMAGES_DIR);

const imageFileNames = fs.readdirSync(publicPath)
  .filter(file => {
    const ext = path.extname(file).toLowerCase();
    return ['.jpg', '.jpeg', '.png', '.gif'].includes(ext);
  })

function shuffleArray(array: any) {
  for (let i = array.length - 1; i > 0; i--) {

    const j = Math.floor(Math.random() * (i + 1));

    [array[i], array[j]] = [array[j], array[i]];
  }
}

shuffleArray(imageFileNames);

const imagePaths = imageFileNames.map(fileName => {
  return `${IMAGES_DIR}/${fileName}`;
});
---

<!doctype html>
<html lang="ja" data-pagefind-ignore>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <meta name="robots" content="noindex" />
    <title>スライドショウ</title>
  </head>
  <body>
    <section>
      <SlideShow imagePaths={imagePaths} client:load />
    </section>
    <div class="timeSlot">
      <ShowTime client:load />
    </div>
  </body>
</html>

<style lang='scss'>
  body {
    width: 100vw;
    margin: 0;
    padding: 0;
    section {
      margin: 0;
      padding: 0;
      width: 100vw;
    }
    .timeSlot {
      position: fixed;
      right: 0;
      top: 0;
      z-index: 1000;
    }
  }
</style>