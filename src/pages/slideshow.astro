---
import * as fs from 'fs';
import * as path from 'path';
import SlideShow from '../components/SlideShow.svelte';
import ShowTime from '../components/ShowTime.svelte';
import '../styles/globals.scss';

// public フォルダ内の画像ディレクトリ
const IMAGES_DIR = '/images/slideshow';
// サーバーサイドでのファイルシステム上の絶対パス
const publicPath = path.join(process.cwd(), 'public', IMAGES_DIR);

// 1. ディレクトリ内のファイル名を取得し、ソート
const imageFileNames = fs.readdirSync(publicPath)
    .filter(file => {
        const ext = path.extname(file).toLowerCase();
        return ['.jpg', '.jpeg', '.png', '.gif'].includes(ext);
    })
    .sort(); // ファイル名昇順でソート

// 2. ブラウザからアクセス可能なURLパスのリストを作成
const imagePaths = imageFileNames.map(fileName => {
    // public フォルダの画像はサイトルート (/) からアクセス可能
    return `${IMAGES_DIR}/${fileName}`;
});
---

<!doctype html>
<html lang="ja" data-pagefind-ignore>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <meta name="robots" content="noindex" />
    <title>スライドショウ</title>
  </head>
  <body>
    <section>
      <SlideShow imagePaths={imagePaths} client:load />
    </section>
    <div class="timeSlot">
      <ShowTime client:load />
    </div>
  </body>
</html>

<style lang='scss'>
  body {
    width: 100vw;
    margin: 0;
    padding: 0;
    section {
      margin: 0;
      padding: 0;
      width: 100vw;
    }
    .timeSlot {
      position: fixed;
      right: 0;
      top: 0;
      z-index: 1000;
    }
  }
</style>